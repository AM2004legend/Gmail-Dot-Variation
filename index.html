<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gmail Dot Generator - Create Unlimited Email Variations</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&family=Merriweather:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Ubuntu", sans-serif;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        color: white;
        background: #000;
        position: relative;
        padding: 10px;
        overflow-x: hidden;
      }

      .background-image {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
      }

      .coming-soon {
        font-family: "Merriweather", serif;
        font-size: 1.8rem;
        font-weight: bold;
        text-align: center;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        margin-bottom: 0.5rem;
        color: white;
        white-space: nowrap;
      }

      .initiative {
        font-family: "Ubuntu", sans-serif;
        font-size: 0.75rem;
        text-align: center;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        margin-bottom: 1rem;
        opacity: 0.8;
        white-space: nowrap;
      }

      .dashboard-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 1.5rem;
        width: 100%;
      }

      .stats-container {
        display: flex;
        gap: 10px;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
      }

      .stat-card {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        padding: 10px 15px;
        text-align: center;
        min-width: 85px;
        flex: 1;
        max-width: 120px;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        overflow: hidden;
        word-wrap: break-word;
      }

      .stat-number {
        font-family: "Ubuntu", sans-serif;
        font-size: 1.2rem;
        font-weight: bold;
        color: #4ecdc4;
        margin-bottom: 3px;
        overflow: visible;
        line-height: 1.2;
        min-height: 1.4rem;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .stat-label {
        font-family: "Ubuntu", sans-serif;
        font-size: 0.65rem;
        opacity: 0.8;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: rgba(255, 255, 255, 0.8);
      }

      .main-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        max-width: 100%;
        width: 100%;
        z-index: 10;
        padding: 0 5px;
      }

      .content-grid {
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 100%;
        align-items: center;
      }

      .info-panel {
        background: linear-gradient(
          135deg,
          rgba(0, 0, 0, 0.8),
          rgba(20, 20, 40, 0.8)
        );
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 15px;
        width: 100%;
        max-width: 100%;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        order: 2;
      }

      .info-title {
        font-family: "Merriweather", serif;
        font-size: 1rem;
        margin-bottom: 10px;
        color: #4ecdc4;
      }

      .info-text {
        font-family: "Ubuntu", sans-serif;
        font-size: 0.8rem;
        line-height: 1.5;
        opacity: 0.9;
        margin-bottom: 10px;
      }

      .feature-list {
        list-style: none;
        padding: 0;
      }

      .feature-list li {
        font-family: "Ubuntu", sans-serif;
        font-size: 0.75rem;
        padding: 6px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        padding-left: 15px;
      }

      .feature-list li:before {
        content: "‚úì";
        position: absolute;
        left: 0;
        color: #4ecdc4;
        font-weight: bold;
      }

      /* Mobile Responsive Styles - Comprehensive Device Support */

      /* Extra Small Devices - Smartwatches, Very Small Phones (240px - 320px) */
      @media (max-width: 320px) {
        body {
          padding: 5px;
          font-size: 12px;
        }

        .coming-soon {
          font-size: 1.1rem;
          margin-bottom: 0.3rem;
          white-space: normal;
          line-height: 1.2;
        }

        .initiative {
          font-size: 0.5rem;
          margin-bottom: 0.8rem;
          white-space: normal;
        }

        .stats-container {
          gap: 5px;
          margin-bottom: 0.8rem;
        }

        .stat-card {
          min-width: 65px;
          max-width: 85px;
          padding: 6px 8px;
        }

        .stat-number {
          font-size: 0.85rem;
          min-height: 1rem;
        }

        .stat-label {
          font-size: 0.5rem;
        }

        .tool-container {
          padding: 18px 16px;
          border-radius: 10px;
        }

        .tool-header {
          font-size: 0.9rem;
          margin-bottom: 18px;
          white-space: normal;
        }

        .tool-input {
          padding: 8px;
          font-size: 12px;
          margin-bottom: 18px;
        }

        .generate-btn {
          padding: 10px;
          font-size: 12px;
          margin-bottom: 16px;
        }

        .info-panel {
          padding: 10px;
        }

        .info-title {
          font-size: 0.8rem;
        }

        .info-text {
          font-size: 0.65rem;
        }

        .feature-list li {
          font-size: 0.6rem;
          padding: 4px 0;
        }

        .result-item {
          padding: 12px 15px;
          font-size: 11px;
          min-height: 44px;
          word-break: break-word;
          overflow-wrap: anywhere;
          white-space: normal;
          line-height: 1.4;
          overflow: hidden;
          flex-shrink: 0;
        }

        .footer {
          margin-top: 1rem;
          padding: 10px;
        }

        .footer-text {
          font-size: 0.65rem;
        }
      }

      /* Small Devices - Small Phones (321px - 480px) */
      @media (min-width: 321px) and (max-width: 480px) {
        body {
          padding: 8px;
        }

        .coming-soon {
          font-size: 1.4rem;
          white-space: normal;
          line-height: 1.3;
        }

        .initiative {
          font-size: 0.6rem;
          white-space: normal;
        }

        .stat-card {
          min-width: 70px;
          max-width: 90px;
          padding: 8px 10px;
        }

        .stat-number {
          font-size: 1rem;
          min-height: 1.2rem;
        }

        .stat-label {
          font-size: 0.6rem;
        }

        .tool-container {
          padding: 22px 18px;
        }

        .tool-header {
          font-size: 1rem;
          white-space: normal;
          margin-bottom: 20px;
        }

        .tool-input {
          padding: 10px;
          font-size: 13px;
          margin-bottom: 20px;
        }

        .generate-btn {
          padding: 12px;
          font-size: 14px;
          margin-bottom: 18px;
        }

        .info-title {
          font-size: 0.85rem;
        }

        .info-text {
          font-size: 0.7rem;
        }

        .feature-list li {
          font-size: 0.65rem;
        }

        .result-item {
          padding: 13px 16px;
          font-size: 12px;
          min-height: 44px;
          word-break: break-word;
          overflow-wrap: anywhere;
          white-space: normal;
          line-height: 1.4;
          overflow: hidden;
          flex-shrink: 0;
        }
      }

      /* Medium Devices - Large Phones, Small Tablets (481px - 768px) */
      @media (min-width: 481px) and (max-width: 768px) {
        body {
          padding: 12px;
        }

        .coming-soon {
          font-size: 1.6rem;
        }

        .initiative {
          font-size: 0.7rem;
        }

        .stats-container {
          gap: 12px;
        }

        .stat-card {
          min-width: 80px;
          max-width: 100px;
          padding: 9px 12px;
        }

        .stat-number {
          font-size: 1.15rem;
          min-height: 1.3rem;
        }

        .stat-label {
          font-size: 0.65rem;
        }

        .tool-container {
          padding: 24px 20px;
        }

        .tool-header {
          font-size: 1.05rem;
          margin-bottom: 22px;
        }

        .info-title {
          font-size: 0.95rem;
        }

        .info-text {
          font-size: 0.75rem;
        }

        .feature-list li {
          font-size: 0.7rem;
        }

        .result-item {
          font-size: 13px;
          padding: 14px 17px;
          min-height: 44px;
          word-break: break-word;
          overflow-wrap: anywhere;
          white-space: normal;
          line-height: 1.4;
          overflow: hidden;
          flex-shrink: 0;
        }
      }

      /* Large Devices - Tablets, Small Laptops (769px - 1024px) */
      @media (min-width: 769px) and (max-width: 1024px) {
        body {
          padding: 15px;
        }

        .coming-soon {
          font-size: 1.9rem;
        }

        .initiative {
          font-size: 0.8rem;
        }

        .stats-container {
          gap: 15px;
          max-width: 600px;
        }

        .stat-card {
          min-width: 85px;
          max-width: 105px;
          padding: 10px 14px;
        }

        .stat-number {
          font-size: 1.3rem;
        }

        .stat-label {
          font-size: 0.68rem;
        }

        .content-grid {
          max-width: 700px;
        }

        .tool-container {
          padding: 30px 26px;
          max-width: 650px;
        }

        .info-panel {
          max-width: 650px;
        }

        .tool-header {
          font-size: 1.2rem;
          margin-bottom: 26px;
        }

        .tool-input {
          padding: 14px;
          font-size: 15px;
          margin-bottom: 24px;
        }

        .generate-btn {
          padding: 16px;
          font-size: 17px;
          margin-bottom: 22px;
        }

        .results-container {
          max-height: 360px;
        }
      }

      /* Extra Large Devices - Desktops, Large Screens (1025px - 1440px) */
      @media (min-width: 1025px) and (max-width: 1440px) {
        body {
          padding: 20px;
        }

        .coming-soon {
          font-size: 2.1rem;
        }

        .initiative {
          font-size: 0.85rem;
        }

        .stats-container {
          gap: 18px;
          max-width: 800px;
        }

        .stat-card {
          min-width: 95px;
          max-width: 120px;
          padding: 12px 16px;
        }

        .stat-number {
          font-size: 1.4rem;
        }

        .stat-label {
          font-size: 0.72rem;
        }

        .content-grid {
          max-width: 900px;
        }

        .tool-container {
          padding: 32px 28px;
          max-width: 800px;
        }

        .info-panel {
          max-width: 800px;
        }

        .tool-header {
          font-size: 1.3rem;
          margin-bottom: 28px;
        }

        .results-container {
          max-height: 400px;
        }
      }

      /* Ultra Wide Screens - Large Desktops, 4K Monitors (1441px+) */
      @media (min-width: 1441px) {
        body {
          padding: 25px;
        }

        .coming-soon {
          font-size: 2.4rem;
        }

        .initiative {
          font-size: 0.9rem;
        }

        .stats-container {
          gap: 25px;
          max-width: 1000px;
        }

        .stat-card {
          min-width: 110px;
          max-width: 140px;
          padding: 15px 18px;
        }

        .stat-number {
          font-size: 1.5rem;
        }

        .stat-label {
          font-size: 0.75rem;
        }

        .content-grid {
          max-width: 1200px;
        }

        .tool-container {
          padding: 36px 32px;
          max-width: 1000px;
        }

        .info-panel {
          max-width: 1000px;
          padding: 20px;
        }

        .tool-header {
          font-size: 1.4rem;
          margin-bottom: 30px;
        }

        .tool-input {
          padding: 16px;
          font-size: 16px;
          margin-bottom: 26px;
        }

        .generate-btn {
          padding: 18px;
          font-size: 18px;
          margin-bottom: 24px;
        }

        .results-container {
          max-height: 480px;
        }

        .info-title {
          font-size: 1.1rem;
        }

        .info-text {
          font-size: 0.85rem;
        }

        .feature-list li {
          font-size: 0.8rem;
        }
      }

      /* Landscape Orientation Adjustments */
      @media (orientation: landscape) and (max-height: 500px) {
        .dashboard-header {
          margin-bottom: 1rem;
        }

        .stats-container {
          margin-bottom: 0.8rem;
        }

        .content-grid {
          gap: 10px;
        }

        .info-panel {
          padding: 12px;
        }

        .tool-container {
          padding: 15px;
        }

        .results-container {
          max-height: 250px;
        }

        .footer {
          margin-top: 1rem;
        }
      }

      /* High DPI Displays */
      @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
        .background-image {
          image-rendering: -webkit-optimize-contrast;
          image-rendering: crisp-edges;
        }

        .tool-header::after {
          height: 3px;
        }
      }

      /* Touch Device Optimizations */
      @media (pointer: coarse) {
        .result-item {
          min-height: 44px; /* Touch target minimum */
        }

        .generate-btn {
          min-height: 44px;
        }

        .tool-input {
          min-height: 44px;
        }

        button[style*="padding: 8px"] {
          padding: 12px 16px !important;
          min-height: 44px;
        }
      }

      /* Foldable Device Support */
      @media (min-width: 280px) and (max-width: 653px) and (min-height: 653px) {
        .content-grid {
          flex-direction: column;
          justify-content: flex-start;
        }

        .tool-container {
          order: 1;
        }

        .info-panel {
          order: 2;
        }
      }

      /* Print Styles */
      @media print {
        .background-image {
          display: none;
        }

        body {
          background: white;
          color: black;
        }

        .generate-btn,
        .footer {
          display: none;
        }

        .result-item {
          border: 1px solid #ccc;
          background: white;
          color: black;
        }
      }

      /* Gmail Generator Tool Styles */
      .tool-container {
        position: relative;
        background: linear-gradient(
          135deg,
          rgba(0, 0, 0, 0.9),
          rgba(20, 20, 40, 0.9)
        );
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        padding: 28px 24px;
        width: 100%;
        max-width: 100%;
        -webkit-backdrop-filter: blur(15px);
        backdrop-filter: blur(15px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        order: 1;
      }

      .tool-container.active {
        transform: translateX(0);
      }

      .tool-toggle {
        display: none;
      }

      .tool-header {
        font-family: "Merriweather", serif;
        font-size: 1.1rem;
        margin-bottom: 24px;
        text-align: center;
        color: white;
        position: relative;
        white-space: nowrap;
      }

      .tool-header::after {
        content: "";
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 2px;
        background: linear-gradient(90deg, #4ecdc4, #45b7d1);
        border-radius: 1px;
      }

      .tool-input {
        width: 100%;
        padding: 12px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 10px;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.1),
          rgba(255, 255, 255, 0.05)
        );
        color: white;
        font-family: "Ubuntu", sans-serif;
        font-size: 14px;
        margin-bottom: 22px;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
        position: relative;
      }

      .tool-input::placeholder {
        color: rgba(255, 255, 255, 0.6);
      }

      .tool-input:focus {
        outline: none;
        border-color: rgba(78, 205, 196, 0.8);
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.15),
          rgba(78, 205, 196, 0.1)
        );
        box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        transform: translateY(-2px);
      }

      .generate-btn {
        width: 100%;
        padding: 15px;
        background: linear-gradient(
          135deg,
          rgba(78, 205, 196, 0.8),
          rgba(69, 183, 209, 0.8)
        );
        border: 2px solid rgba(78, 205, 196, 0.5);
        border-radius: 12px;
        color: white;
        font-family: "Ubuntu", sans-serif;
        font-weight: 700;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: none;
        letter-spacing: 0.5px;
        margin-bottom: 20px;
      }

      .generate-btn:hover {
        background: linear-gradient(
          135deg,
          rgba(255, 107, 107, 0.8),
          rgba(254, 202, 87, 0.8)
        );
        border-color: rgba(255, 107, 107, 0.8);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
      }

      .generate-btn:active {
        transform: translateY(0px);
      }

      .results-container {
        margin-top: 0px;
        margin-bottom: 0px;
        padding-bottom: 0px;
        max-height: 320px;
        overflow-y: auto;
        padding-right: 5px;
        position: relative;
        border: none;
        box-shadow: none;
      }

      .results-container::-webkit-scrollbar {
        width: 0px;
        background: transparent;
      }

      .scroll-button {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          rgba(78, 205, 196, 0.9),
          rgba(69, 183, 209, 0.9)
        );
        border: 2px solid rgba(78, 205, 196, 0.6);
        color: white;
        font-size: 11px;
        font-weight: bold;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        z-index: 100;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        margin: 0 2px;
      }

      .scroll-button:hover {
        background: linear-gradient(
          135deg,
          rgba(255, 107, 107, 0.9),
          rgba(254, 202, 87, 0.9)
        );
        border-color: rgba(255, 107, 107, 0.8);
        transform: translateY(-50%) scale(1.1);
        box-shadow: 0 4px 10px rgba(78, 205, 196, 0.4);
      }

      .scroll-button.scroll-up {
        right: 50px;
      }

      .scroll-button.scroll-down {
        right: 15px;
      }

      .result-item {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.08),
          rgba(255, 255, 255, 0.03)
        );
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        padding: 15px 18px;
        margin-bottom: 8px;
        font-family: "Ubuntu", sans-serif;
        font-size: 14px;
        color: white;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        word-break: break-word;
        overflow-wrap: anywhere;
        white-space: normal;
        min-height: 44px;
        display: flex;
        align-items: flex-start;
        box-sizing: border-box;
        flex-shrink: 0;
        width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.4;
        max-width: 100%;
      }

      .result-item:last-child {
        margin-bottom: 0;
      }

      .result-item:hover {
        background: linear-gradient(
          135deg,
          rgba(78, 205, 196, 0.15),
          rgba(69, 183, 209, 0.1)
        );
        border-color: rgba(78, 205, 196, 0.4);
        transform: translateX(3px);
      }

      .result-item:focus {
        outline: none;
        background: linear-gradient(
          135deg,
          rgba(78, 205, 196, 0.15),
          rgba(69, 183, 209, 0.1)
        );
        border-color: rgba(78, 205, 196, 0.4);
        box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.3);
        transform: none;
        word-break: break-word;
        overflow-wrap: anywhere;
        white-space: normal;
        overflow: hidden;
        flex-shrink: 0;
      }

      .result-item:active {
        transform: scale(0.98);
        word-break: break-word;
        overflow-wrap: anywhere;
        white-space: normal;
        overflow: hidden;
        flex-shrink: 0;
      }

      .result-item.copied {
        background: linear-gradient(
          135deg,
          rgba(0, 255, 100, 0.3),
          rgba(0, 200, 80, 0.2)
        );
        border-color: rgba(0, 255, 100, 0.8);
        box-shadow: 0 0 10px rgba(0, 255, 100, 0.3);
        word-break: break-word;
        overflow-wrap: anywhere;
        white-space: normal;
        overflow: hidden;
        flex-shrink: 0;
        transform: none;
      }

      /* Ensure no text cutoff during any interaction */
      .result-item,
      .result-item:hover,
      .result-item:focus,
      .result-item:active,
      .result-item.copied {
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: normal;
        word-break: break-word;
        overflow-wrap: anywhere;
        flex-shrink: 0;
        width: auto;
        max-width: 100%;
      }

      /* Footer Styles */
      .footer {
        margin-top: 2rem;
        padding: 15px;
        text-align: center;
        background: linear-gradient(
          135deg,
          rgba(0, 0, 0, 0.6),
          rgba(20, 20, 40, 0.6)
        );
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        width: 100%;
      }

      .footer-text {
        font-family: "Ubuntu", sans-serif;
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 5px;
      }

      .footer-link {
        color: #4ecdc4;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .footer-link:hover {
        color: #45b7d1;
        text-shadow: 0 0 5px rgba(78, 205, 196, 0.5);
      }

      .heart {
        color: #ff6b6b;
        font-size: 0.9rem;
        animation: heartbeat 2s ease-in-out infinite;
      }

      @keyframes heartbeat {
        0%,
        50%,
        100% {
          transform: scale(1);
        }
        25%,
        75% {
          transform: scale(1.1);
        }
      }

      /* Notification styles */
      #notificationContainer {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
        max-width: 400px;
      }

      .notification {
        padding: 15px 20px;
        border-radius: 10px;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        animation: slideIn 0.3s ease;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 0.95rem;
        word-wrap: break-word;
        max-width: 350px;
      }

      .notification.success {
        background: linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(69, 183, 209, 0.2));
        border: 1px solid rgba(78, 205, 196, 0.4);
        color: #4ecdc4;
      }

      .notification.error {
        background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(255, 71, 87, 0.2));
        border: 1px solid rgba(255, 107, 107, 0.4);
        color: #ff6b6b;
      }

      .notification.info {
        background: linear-gradient(135deg, rgba(100, 150, 255, 0.2), rgba(100, 200, 255, 0.2));
        border: 1px solid rgba(100, 150, 255, 0.4);
        color: #64b3ff;
      }

      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }

      .notification.removing {
        animation: slideOut 0.3s ease;
      }
    </style>
  </head>
  <body>
    <!-- Notification Container -->
    <div id="notificationContainer"></div>
    
    <div class="main-content">
      <div class="dashboard-header">
        <h1 class="coming-soon">Gmail Dot Generator</h1>
        <p class="initiative">Professional Email Variation Dashboard</p>
        
        <div style="display: flex; gap: 10px; margin: 10px 0; justify-content: center; flex-wrap: wrap; font-size: 0.85rem;">
          <span id="userEmail" style="color: #4ecdc4;"></span>
          <button id="viewSavedBtn" style="padding: 6px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); background: transparent; color: #fff; cursor: pointer; font-size: 0.85rem; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#4ecdc4'; this.style.color='#4ecdc4';" onmouseout="this.style.borderColor='rgba(255,255,255,0.12)'; this.style.color='#fff';">Saved Emails</button>
          <button id="logoutBtn" style="padding: 6px 12px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.12); background: transparent; color: #fff; cursor: pointer; font-size: 0.85rem; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#4ecdc4'; this.style.color='#4ecdc4';" onmouseout="this.style.borderColor='rgba(255,255,255,0.12)'; this.style.color='#fff';">Logout</button>
        </div>

        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-number" id="totalGenerated">0</div>
            <div class="stat-label">Generated</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="currentVariations">0</div>
            <div class="stat-label">Current</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="allPossible">0</div>
            <div class="stat-label">All Possible</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="timesSaved">0</div>
            <div class="stat-label">Saved</div>
          </div>
        </div>
      </div>

      <div class="content-grid">
        <div class="info-panel">
          <h3 class="info-title">About Gmail Dot Trick</h3>
          <p class="info-text">
            Gmail ignores dots in email addresses, allowing you to create
            multiple variations of your email while all messages go to the same
            inbox.
          </p>

          <h3 class="info-title">Our Service</h3>
          <ul class="feature-list">
            <li>Instant email variations</li>
            <li>Gmail & Googlemail support</li>
            <li>One-click copy to clipboard</li>
            <li>Unlimited generations</li>
            <li>No registration required</li>
            <li>100% free to use</li>
          </ul>

          <p class="info-text">
            <strong>Pro Tip:</strong> Use different variations for online
            shopping, newsletters, or trial accounts to organize your inbox
            better!
          </p>
        </div>

        <div class="tool-container active" id="toolContainer">
          <div class="tool-header">Create Email Variations</div>
          <input
            type="email"
            class="tool-input"
            id="emailInput"
            placeholder="Enter your Gmail address (e.g. yourname@gmail.com)..."
            onkeypress="handleKeyPress(event)"
          />
          <button class="generate-btn" onclick="generateEmails()">
            ‚ú® Generate Magic Variations ‚ú®
          </button>
          <div class="results-container" id="resultsContainer"></div>
        </div>
      </div>

      <div class="footer">
        </div>
      
      <!-- Saved Emails Modal -->
      <div id="savedEmailsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; overflow-y: auto;">
        <div style="background: linear-gradient(135deg, rgba(30,30,50,0.95), rgba(50,30,80,0.95)); border: 1px solid rgba(78, 205, 196, 0.3); border-radius: 15px; padding: 30px; max-width: 600px; width: 90%; margin: 50px auto; -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="color: #4ecdc4; margin: 0; font-size: 1.5rem;">üìß Saved Email Variations</h2>
            <button onclick="closeSavedEmailsModal()" style="background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; padding: 0;">‚úï</button>
          </div>
          
          <div id="savedEmailsList" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
            <div style="text-align: center; color: #aaa; padding: 20px;">Loading saved emails...</div>
          </div>
          
          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button onclick="closeSavedEmailsModal()" style="padding: 8px 16px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: transparent; color: #fff; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#4ecdc4'; this.style.color='#4ecdc4';" onmouseout="this.style.borderColor='rgba(255,255,255,0.2)'; this.style.color='#fff';">Close</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize Supabase
      const SUPABASE_URL = 'https://lwmidjhyrlswpfjnyrqs.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx3bWlkamh5cmxzd3Bmam55cnFzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0NjU2MDEsImV4cCI6MjA4MDA0MTYwMX0.hSg6XR2L19Z9gcarXvjUSpQoZaHWmtNf7eBhmYKV5fw';
      const { createClient } = window.supabase;
      const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

      // ===== NOTIFICATION SYSTEM =====
      function showNotification(message, type = 'info', duration = 3000) {
        const container = document.getElementById('notificationContainer');
        if (!container) return;

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        // Add emoji based on type
        const emoji = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è';
        notification.innerHTML = `<span>${emoji}</span><span>${message}</span>`;
        
        container.appendChild(notification);

        // Auto remove after duration
        setTimeout(() => {
          notification.classList.add('removing');
          setTimeout(() => notification.remove(), 300);
        }, duration);
      }

      // ===== DATABASE FUNCTIONS =====
      
      // Save email variation to database
      async function saveEmailVariation(email) {
        try {
          const userId = sessionStorage.getItem('userId');
          const authToken = sessionStorage.getItem('authToken');
          
          console.log('saveEmailVariation called with:', email);
          console.log('userId:', userId);
          console.log('authToken exists:', !!authToken);
          
          if (!userId || !authToken) {
            console.log('Not authenticated, cannot save to database');
            showNotification('Not authenticated. Please login to save emails.', 'error');
            return false;
          }

          // Validate that userId is a valid UUID format
          const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
          if (!uuidRegex.test(userId)) {
            console.error('Invalid userId format:', userId);
            console.error('Expected UUID format but got:', typeof userId, userId);
            showNotification('‚ùå Invalid user session. Please logout and login again.', 'error');
            return false;
          }

          console.log('Inserting email into database...');
          const { data, error } = await supabase
            .from('saved_emails')
            .insert([
              {
                user_id: userId,
                email: email,
                created_at: new Date().toISOString()
              }
            ])
            .select();

          if (error) {
            // Ignore duplicate key errors (unique constraint)
            if (error.code === 'PGRST116' || (error.message && error.message.includes('duplicate'))) {
              console.log('Email already saved (duplicate)');
              showNotification('Email already saved!', 'info', 2000);
              return true;
            }
            console.error('‚ùå ERROR SAVING EMAIL');
            console.error('Error code:', error.code);
            console.error('Error message:', error.message);
            console.error('Error status:', error.status);
            console.error('Error details:', error.details);
            console.error('Full error:', JSON.stringify(error, null, 2));
            
            // More specific error messages
            let errorMsg = 'Error saving email';
            
            // Check for network/fetch errors (most common)
            if (!error.code && !error.message) {
              errorMsg = '‚ùå Network error: Cannot reach database. Check Supabase URL and Key.';
            } else if (error.message && (error.message.includes('fetch') || error.message.includes('Failed to fetch') || error.message.includes('network'))) {
              errorMsg = '‚ùå Network error: Cannot reach database. Check internet connection.';
            } else if (error.message && error.message.includes('ECONNREFUSED')) {
              errorMsg = '‚ùå Network error: Database connection refused. Server may be down.';
            } else if (error.code === 'PGRST116') {
              errorMsg = 'Duplicate email (already saved)';
            } else if (error.message && error.message.includes('relation') && error.message.includes('does not exist')) {
              errorMsg = '‚ùå Database tables not created. Run SQL from SUPABASE_COMPLETE.md';
            } else if (error.message && (error.message.includes('permission') || error.message.includes('policy'))) {
              errorMsg = '‚ùå RLS policy blocking save. Check Supabase RLS settings.';
            } else if (error.message && error.message.includes('JWT')) {
              errorMsg = '‚ùå Authentication invalid. Try logging out and back in.';
            } else if (error.message && error.message.includes('timeout')) {
              errorMsg = '‚ùå Request timeout. Database is taking too long to respond.';
            } else if (error.status === 401) {
              errorMsg = '‚ùå Unauthorized: Check your Supabase API key.';
            } else if (error.status === 400) {
              errorMsg = '‚ùå Bad request: Check your data format.';
            } else if (error.message) {
              errorMsg = '‚ùå ' + error.message;
            }
            
            showNotification(errorMsg, 'error', 5000);
            return false;
          }

          console.log('Email saved successfully:', data);
          showNotification('‚úÖ Email saved successfully! üíæ', 'success', 2000);
          return true;
        } catch (err) {
          console.error('‚ùå EXCEPTION SAVING EMAIL');
          console.error('Exception message:', err.message);
          console.error('Exception name:', err.name);
          console.error('Exception stack:', err.stack);
          console.error('Full exception:', JSON.stringify(err, null, 2));
          
          let errorMsg = 'Error saving email';
          
          // Network-related errors (most common)
          if (err.message && (err.message.includes('fetch') || err.message.includes('Failed to fetch'))) {
            errorMsg = '‚ùå Network error: Cannot reach database. Check internet connection.';
          } else if (err.name === 'TypeError' && (err.message.includes('fetch') || err.message.includes('Failed'))) {
            errorMsg = '‚ùå Network error: Cannot reach database. Check Supabase URL.';
          } else if (err.message && err.message.includes('ECONNREFUSED')) {
            errorMsg = '‚ùå Network error: Database connection refused. Server may be down.';
          } else if (err.message && err.message.includes('ENOTFOUND')) {
            errorMsg = '‚ùå Network error: Cannot resolve database address. Check DNS.';
          } else if (err.message && err.message.includes('ETIMEDOUT')) {
            errorMsg = '‚ùå Network timeout: Request took too long. Check connection.';
          } else if (err.message && err.message.includes('not defined')) {
            errorMsg = '‚ùå Database not initialized. Please refresh the page.';
          } else if (err.message && err.message.includes('supabase')) {
            errorMsg = '‚ùå Supabase error: ' + err.message;
          } else {
            errorMsg = '‚ùå Exception: ' + (err.message || 'Unknown error');
          }
          
          showNotification(errorMsg, 'error', 4000);
          return false;
        }
      }

      // Fetch user's saved emails from database
      async function fetchSavedEmails() {
        try {
          const userId = sessionStorage.getItem('userId');
          const authToken = sessionStorage.getItem('authToken');
          
          console.log('fetchSavedEmails - userId:', userId, 'authToken exists:', !!authToken);
          
          if (!userId || !authToken) {
            console.log('Not authenticated');
            showNotification('Not authenticated. Please login.', 'error');
            return [];
          }

          console.log('Querying saved_emails for user:', userId);
          const { data, error } = await supabase
            .from('saved_emails')
            .select('*')
            .eq('user_id', userId)
            .order('created_at', { ascending: false });

          if (error) {
            console.error('Error fetching emails:', error);
            console.error('Error code:', error.code);
            console.error('Error details:', JSON.stringify(error));
            
            let errorMsg = 'Error loading emails: ' + error.message;
            if (error.message.includes('does not exist')) {
              errorMsg = '‚ùå Tables not created. Run SQL from SETUP_DATABASE.md';
            } else if (error.message.includes('policy')) {
              errorMsg = '‚ùå RLS policy issue. Check Supabase settings.';
            }
            
            showNotification(errorMsg, 'error', 4000);
            return [];
          }

          console.log('Fetched emails:', data);
          if (data && data.length > 0) {
            showNotification(`‚úÖ Loaded ${data.length} saved email(s)`, 'success', 2000);
          } else {
            console.log('No emails found for this user');
          }
          return data || [];
        } catch (err) {
          console.error('Exception fetching emails:', err);
          showNotification('Exception: ' + err.message, 'error', 4000);
          return [];
        }
      }

      // Delete saved email from database
      async function deleteSavedEmail(emailId) {
        try {
          console.log('Deleting email with ID:', emailId);
          const { error } = await supabase
            .from('saved_emails')
            .delete()
            .eq('id', emailId);

          if (error) {
            console.error('Error deleting email:', error);
            console.error('Error code:', error.code);
            
            let errorMsg = 'Error deleting email: ' + error.message;
            if (error.message.includes('does not exist')) {
              errorMsg = '‚ùå Database table issue. Check SETUP_DATABASE.md';
            } else if (error.message.includes('policy')) {
              errorMsg = '‚ùå RLS policy blocking deletion. Check Supabase settings.';
            }
            
            showNotification(errorMsg, 'error', 4000);
            return false;
          }

          console.log('Email deleted successfully');
          showNotification('‚úÖ Email deleted successfully! üóëÔ∏è', 'success', 2000);
          return true;
        } catch (err) {
          console.error('Exception deleting email:', err);
          showNotification('Exception: ' + err.message, 'error', 4000);
          return false;
        }
      }

      // Update user profile
      async function updateUserProfile(updates) {
        try {
          const userId = sessionStorage.getItem('userId');
          const authToken = sessionStorage.getItem('authToken');
          
          if (!userId || !authToken) {
            showNotification('Not authenticated', 'error');
            return false;
          }

          console.log('Updating profile for user:', userId, 'with updates:', updates);
          const { data, error } = await supabase
            .from('user_profiles')
            .update(updates)
            .eq('user_id', userId)
            .select();

          if (error) {
            console.error('Error updating profile:', error);
            console.error('Error code:', error.code);
            
            let errorMsg = 'Error updating profile: ' + error.message;
            if (error.message.includes('does not exist')) {
              errorMsg = '‚ùå Database table not created. Run SQL from SETUP_DATABASE.md';
            } else if (error.message.includes('policy')) {
              errorMsg = '‚ùå RLS policy blocking update. Check Supabase settings.';
            }
            
            showNotification(errorMsg, 'error', 4000);
            return false;
          }

          console.log('Profile updated:', data);
          showNotification('‚úÖ Profile updated successfully', 'success', 2000);
          return true;
        } catch (err) {
          console.error('Exception updating profile:', err);
          showNotification('Exception: ' + err.message, 'error', 4000);
          return false;
        }
      }

      // ===== END DATABASE FUNCTIONS =====

      // Auth Guard - Check if user is logged in
      (async function requireAuth() {
        try {
          const token = sessionStorage.getItem("authToken");
          const userId = sessionStorage.getItem("userId");
          const userEmail = sessionStorage.getItem("userEmail");

          if (!token || !userId) {
            window.location.href = "login.html";
            return;
          }

          // Display user email
          const userEmailEl = document.getElementById("userEmail");
          if (userEmailEl) {
            userEmailEl.textContent = `Logged in as: ${userEmail}`;
          }
        } catch (e) {
          window.location.href = "login.html";
        }
      })();

      // Logout handler
      const logoutBtn = document.getElementById("logoutBtn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", async () => {
          await supabase.auth.signOut();
          try { sessionStorage.clear(); } catch (e) {}
          window.location.href = "login.html";
        });
      }

      // Saved Emails handler
      const viewSavedBtn = document.getElementById("viewSavedBtn");
      if (viewSavedBtn) {
        viewSavedBtn.addEventListener("click", openSavedEmailsModal);
      }

      async function openSavedEmailsModal() {
        const modal = document.getElementById("savedEmailsModal");
        const list = document.getElementById("savedEmailsList");
        
        console.log('Opening saved emails modal...');
        console.log('Modal element:', modal);
        console.log('List element:', list);
        
        if (!modal || !list) {
          console.error('Modal or list element not found!');
          showNotification('Error: Modal not found!', 'error');
          return;
        }
        
        modal.style.display = "block";
        list.innerHTML = '<div style="text-align: center; color: #aaa; padding: 20px;">Loading...</div>';
        
        try {
          const userId = sessionStorage.getItem("userId");
          console.log('User ID from session:', userId);
          
          if (!userId) {
            console.warn('No user ID found in sessionStorage');
            list.innerHTML = '<div style="text-align: center; color: #ff6b6b; padding: 20px;">Not authenticated. Please login again.</div>';
            showNotification('Not authenticated. Please login.', 'error');
            return;
          }
          
          console.log('Fetching saved emails...');
          const emails = await fetchSavedEmails();
          console.log('Fetched emails:', emails);
          
          if (!emails || emails.length === 0) {
            console.log('No emails found');
            list.innerHTML = '<div style="text-align: center; color: #aaa; padding: 20px;">No saved emails yet. Start generating and copying emails to save them!</div>';
            showNotification('No saved emails yet', 'info');
            return;
          }
          
          console.log('Rendering', emails.length, 'emails');
          list.innerHTML = emails.map(email => `
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; margin-bottom: 8px; background: rgba(255,255,255,0.05); border: 1px solid rgba(78, 205, 196, 0.1); border-radius: 8px; word-break: break-all;">
              <span style="color: #4ecdc4; flex-grow: 1; margin-right: 10px;">${email.email || 'Unknown'}</span>
              <button onclick="deleteSavedAndRefresh('${email.id}')" style="padding: 4px 8px; border-radius: 4px; border: 1px solid rgba(255,100,100,0.3); background: transparent; color: #ff6b6b; cursor: pointer; font-size: 0.8rem; transition: all 0.2s ease; white-space: nowrap; margin-left: 10px;" onmouseover="this.style.background='rgba(255,100,100,0.2)'; this.style.borderColor='rgba(255,100,100,0.5)';" onmouseout="this.style.background='transparent'; this.style.borderColor='rgba(255,100,100,0.3)';">Delete</button>
            </div>
          `).join('');
          showNotification(`Showing ${emails.length} saved email(s)`, 'success', 1500);
        } catch (error) {
          console.error('Error in openSavedEmailsModal:', error);
          list.innerHTML = '<div style="text-align: center; color: #ff6b6b; padding: 20px;">Error loading saved emails. Check if database is set up correctly.</div>';
          showNotification('Error loading saved emails: ' + error.message, 'error', 4000);
        }
      }

      function closeSavedEmailsModal() {
        const modal = document.getElementById("savedEmailsModal");
        if (modal) modal.style.display = "none";
      }

      async function deleteSavedAndRefresh(emailId) {
        if (confirm('Delete this email variation?')) {
          try {
            await deleteSavedEmail(emailId);
            openSavedEmailsModal(); // Refresh the list
          } catch (error) {
            console.error('Error deleting email:', error);
            alert('Failed to delete email');
          }
        }
      }

      let totalGeneratedCount = 0;
      let timesSavedCount = 0;
      let currentSearchTerm = "";
      let currentAllPossible = 0;

      // Performance monitoring
      let generationStartTime = 0;
      let lastGenerationTime = 0;

      // Load saved emails count from Supabase on page load
      async function loadSavedEmailsCount() {
        try {
          const userId = sessionStorage.getItem('userId');
          if (!userId) {
            console.log('Not authenticated, cannot load saved count');
            return;
          }

          const { data, error } = await supabase
            .from('saved_emails')
            .select('id', { count: 'exact', head: true })
            .eq('user_id', userId);

          if (error) {
            console.error('Error loading saved count:', error);
            return;
          }

          // Set the count from database
          if (data && data.length >= 0) {
            timesSavedCount = data.length || 0;
            document.getElementById("timesSaved").textContent = formatNumber(timesSavedCount);
            console.log('Loaded saved emails count:', timesSavedCount);
          }
        } catch (err) {
          console.error('Exception loading saved count:', err);
        }
      }

      // Call this on page load
      window.addEventListener('load', loadSavedEmailsCount);

      function handleKeyPress(event) {
        if (event.key === "Enter") {
          generateEmails();
        }
      }

      function updateStats(currentCount, allPossibleCount = null) {
        totalGeneratedCount += currentCount;

        document.getElementById("totalGenerated").textContent =
          formatNumber(totalGeneratedCount);
        document.getElementById("currentVariations").textContent =
          formatNumber(currentCount);
        document.getElementById("timesSaved").textContent =
          formatNumber(timesSavedCount);

        if (allPossibleCount !== null) {
          currentAllPossible = allPossibleCount;
          document.getElementById("allPossible").textContent =
            formatNumber(currentAllPossible);
        }
      }

      function incrementSavedCount() {
        timesSavedCount++;
        document.getElementById("timesSaved").textContent =
          formatNumber(timesSavedCount);
      }

      // Format numbers for display (handles large numbers)
      function formatNumber(num) {
        if (num >= 1000000000) {
          return (num / 1000000000).toFixed(1) + "B";
        } else if (num >= 1000000) {
          return (num / 1000000).toFixed(1) + "M";
        } else if (num >= 1000) {
          return (num / 1000).toFixed(1) + "K";
        } else {
          return num.toString();
        }
      }

      // Add search functionality for large datasets
      function addSearchBox(container) {
        const searchWrapper = document.createElement("div");
        searchWrapper.style.cssText = `
          position: relative;
          width: 100%;
          margin-bottom: 10px;
        `;

        const searchBox = document.createElement("input");
        searchBox.type = "text";
        searchBox.placeholder = "Search through variations...";
        searchBox.style.cssText = `
          width: 100%;
          padding: 12px 15px 12px 40px;
          border: 1px solid rgba(255, 255, 255, 0.3);
          border-radius: 8px;
          background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
          color: white;
          font-family: "Ubuntu", sans-serif;
          font-size: 14px;
          backdrop-filter: blur(10px);
          box-sizing: border-box;
          min-height: 48px;
          transition: all 0.3s ease;
          line-height: 1.4;
          vertical-align: middle;
          display: block;
          outline: none;
        `;

        const searchIcon = document.createElement("div");
        searchIcon.innerHTML = "üîç";
        searchIcon.style.cssText = `
          position: absolute;
          left: 14px;
          top: 50%;
          transform: translateY(-50%);
          font-size: 16px;
          color: rgba(255, 255, 255, 0.6);
          pointer-events: none;
          z-index: 1;
          line-height: 1;
          display: flex;
          align-items: center;
          justify-content: center;
        `;

        // Responsive font sizes and padding
        const screenWidth = window.innerWidth;
        searchBox.style.fontSize =
          screenWidth <= 320
            ? "11px"
            : screenWidth <= 480
            ? "12px"
            : screenWidth <= 768
            ? "13px"
            : "14px";

        searchBox.style.padding =
          screenWidth <= 320
            ? "10px 12px 10px 35px"
            : screenWidth <= 480
            ? "11px 14px 11px 38px"
            : "12px 15px 12px 40px";

        searchIcon.style.fontSize =
          screenWidth <= 320 ? "14px" : screenWidth <= 480 ? "15px" : "16px";

        searchIcon.style.left =
          screenWidth <= 320 ? "12px" : screenWidth <= 480 ? "13px" : "14px";

        searchBox.addEventListener("input", (e) => {
          currentSearchTerm = e.target.value.toLowerCase();
          filterAndDisplayResults();
        });

        // Focus and blur effects
        searchBox.addEventListener("focus", () => {
          searchBox.style.borderColor = "rgba(78, 205, 196, 0.8)";
          searchBox.style.boxShadow = "0 0 15px rgba(78, 205, 196, 0.3)";
          searchIcon.style.color = "rgba(78, 205, 196, 0.8)";
        });

        searchBox.addEventListener("blur", () => {
          searchBox.style.borderColor = "rgba(255, 255, 255, 0.3)";
          searchBox.style.boxShadow = "none";
          searchIcon.style.color = "rgba(255, 255, 255, 0.6)";
        });

        searchWrapper.appendChild(searchIcon);
        searchWrapper.appendChild(searchBox);
        container.insertBefore(searchWrapper, container.firstChild);
        return searchBox;
      }

      function filterAndDisplayResults() {
        if (!currentSearchTerm) {
          // Show all results
          allVariations = [...originalVariations];
        } else {
          // Filter results
          allVariations = originalVariations.filter((email) =>
            email.toLowerCase().includes(currentSearchTerm)
          );
        }

        if (virtualScrollContainer) {
          virtualScrollContainer.content.style.height = `${
            allVariations.length * ITEM_HEIGHT
          }px`;
          virtualScrollContainer.scrollTop = 0;
          virtualScrollContainer.wrapper.scrollTop = 0;
          renderVisibleItems();
        }
      }

      // Add bulk actions functionality
      function addBulkActions(container) {
        const actionsDiv = document.createElement("div");
        actionsDiv.style.cssText = `
          display: flex;
          gap: 10px;
          margin-bottom: 10px;
          flex-wrap: wrap;
          width: 100%;
        `;

        // Responsive gap and layout
        const screenWidth = window.innerWidth;
        if (screenWidth <= 320) {
          actionsDiv.style.gap = "5px";
          actionsDiv.style.flexDirection = "column";
        } else if (screenWidth <= 480) {
          actionsDiv.style.gap = "8px";
        }

        const baseBtnStyle = `
          background: linear-gradient(135deg, rgba(69, 183, 209, 0.8), rgba(78, 205, 196, 0.8));
          border: 1px solid rgba(69, 183, 209, 0.5);
          border-radius: 6px;
          color: white;
          font-family: "Ubuntu", sans-serif;
          cursor: pointer;
          flex: 1;
          min-width: 80px;
          min-height: 44px;
          transition: all 0.3s ease;
          box-sizing: border-box;
        `;

        // Download as CSV button
        const downloadCsvBtn = document.createElement("button");
        downloadCsvBtn.textContent = "üìä Download CSV";

        // Responsive button styling
        if (screenWidth <= 320) {
          downloadCsvBtn.style.cssText =
            baseBtnStyle +
            `
            padding: 8px 10px;
            font-size: 10px;
            min-width: 100%;
          `;
        } else if (screenWidth <= 480) {
          downloadCsvBtn.style.cssText =
            baseBtnStyle +
            `
            padding: 8px 12px;
            font-size: 11px;
            min-width: 45%;
          `;
        } else if (screenWidth <= 768) {
          downloadCsvBtn.style.cssText =
            baseBtnStyle +
            `
            padding: 9px 14px;
            font-size: 12px;
          `;
        } else {
          downloadCsvBtn.style.cssText =
            baseBtnStyle +
            `
            padding: 8px 12px;
            font-size: 12px;
          `;
        }

        downloadCsvBtn.onclick = () => downloadVariationsAsCSV();

        // Hover effects for CSV button
        downloadCsvBtn.addEventListener("mouseenter", () => {
          downloadCsvBtn.style.background =
            "linear-gradient(135deg, rgba(78, 205, 196, 0.9), rgba(69, 183, 209, 0.9))";
          downloadCsvBtn.style.transform = "translateY(-1px)";
        });

        downloadCsvBtn.addEventListener("mouseleave", () => {
          downloadCsvBtn.style.background =
            "linear-gradient(135deg, rgba(69, 183, 209, 0.8), rgba(78, 205, 196, 0.8))";
          downloadCsvBtn.style.transform = "translateY(0)";
        });

        // Download as TXT button
        const downloadTxtBtn = document.createElement("button");
        downloadTxtBtn.textContent = "üíæ Download TXT";
        downloadTxtBtn.style.cssText = downloadCsvBtn.style.cssText;
        downloadTxtBtn.onclick = () => downloadVariations();

        // Same hover effects for TXT button
        downloadTxtBtn.addEventListener("mouseenter", () => {
          downloadTxtBtn.style.background =
            "linear-gradient(135deg, rgba(78, 205, 196, 0.9), rgba(69, 183, 209, 0.9))";
          downloadTxtBtn.style.transform = "translateY(-1px)";
        });

        downloadTxtBtn.addEventListener("mouseleave", () => {
          downloadTxtBtn.style.background =
            "linear-gradient(135deg, rgba(69, 183, 209, 0.8), rgba(78, 205, 196, 0.8))";
          downloadTxtBtn.style.transform = "translateY(0)";
        });

        actionsDiv.appendChild(downloadCsvBtn);
        actionsDiv.appendChild(downloadTxtBtn);
        container.appendChild(actionsDiv);
      }

      function addScrollButtons(container) {
        // Skip scroll buttons on mobile devices to prevent layout issues
        const isMobile =
          window.innerWidth <= 768 ||
          /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(
            navigator.userAgent
          );
        if (isMobile) {
          return;
        }

        // Only add scroll buttons if container is scrollable
        if (container.scrollHeight <= container.clientHeight) {
          return;
        }

        // Find the tool header to append the buttons to
        const toolHeader = document.querySelector(".tool-header");
        if (!toolHeader) return;

        // Remove existing scroll buttons if any
        const existingButtons = toolHeader.querySelectorAll(".scroll-button");
        existingButtons.forEach((btn) => btn.remove());

        // Create scroll up button
        const scrollUpBtn = document.createElement("button");
        scrollUpBtn.className = "scroll-button scroll-up";
        scrollUpBtn.innerHTML = "‚ñ≤";
        scrollUpBtn.title = "Scroll Up";

        // Create scroll down button
        const scrollDownBtn = document.createElement("button");
        scrollDownBtn.className = "scroll-button scroll-down";
        scrollDownBtn.innerHTML = "‚ñº";
        scrollDownBtn.title = "Scroll Down";

        // Add click handlers for smooth scrolling
        scrollUpBtn.addEventListener("click", () => {
          container.scrollBy({
            top: -120,
            behavior: "smooth",
          });
        });

        scrollDownBtn.addEventListener("click", () => {
          container.scrollBy({
            top: 120,
            behavior: "smooth",
          });
        });

        // Visual feedback for button states
        const updateButtonStates = () => {
          const isAtTop = container.scrollTop <= 10;
          const isAtBottom =
            container.scrollTop >=
            container.scrollHeight - container.clientHeight - 10;

          // Update up button
          if (isAtTop) {
            scrollUpBtn.style.opacity = "0.5";
            scrollUpBtn.style.cursor = "not-allowed";
          } else {
            scrollUpBtn.style.opacity = "1";
            scrollUpBtn.style.cursor = "pointer";
          }

          // Update down button
          if (isAtBottom) {
            scrollDownBtn.style.opacity = "0.5";
            scrollDownBtn.style.cursor = "not-allowed";
          } else {
            scrollDownBtn.style.opacity = "1";
            scrollDownBtn.style.cursor = "pointer";
          }
        };

        // Listen for scroll events to update button states
        container.addEventListener("scroll", updateButtonStates);

        // Initial state update
        setTimeout(updateButtonStates, 100);

        // Append buttons to tool header (make it relative positioned)
        toolHeader.style.position = "relative";
        toolHeader.appendChild(scrollUpBtn);
        toolHeader.appendChild(scrollDownBtn);
      }

      function downloadVariationsAsCSV() {
        const variationsToUse = currentSearchTerm
          ? allVariations
          : originalVariations;

        // Create CSV content with headers
        let csvContent = "Email Variation,Domain Type,Has Dots\n";

        variationsToUse.forEach((email) => {
          const [username, domain] = email.split("@");
          const domainType = "Gmail"; // Hardcoded as we only generate gmail.com
          const hasDots = username.includes(".") ? "Yes" : "No";

          // Escape commas and quotes in email addresses
          const escapedEmail = email.includes(",") ? `"${email}"` : email;
          csvContent += `${escapedEmail},${domainType},${hasDots}\n`;
        });

        // Create and download the CSV file
        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `gmail-variations-${
          variationsToUse.length
        }-${Date.now()}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        // Update saved count
        timesSavedCount += variationsToUse.length;
        updateStats(0);

        // Show feedback
        showDownloadFeedback(
          `üìä Downloaded ${variationsToUse.length.toLocaleString()} variations as CSV!`
        );
      }

      function showDownloadFeedback(message) {
        const feedback = document.createElement("div");
        const screenWidth = window.innerWidth;

        let feedbackStyle = `
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: linear-gradient(135deg, rgba(0, 255, 100, 0.95), rgba(0, 200, 80, 0.95));
          color: white;
          border-radius: 8px;
          font-family: "Ubuntu", sans-serif;
          font-weight: bold;
          z-index: 10000;
          box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
          backdrop-filter: blur(10px);
          text-align: center;
          max-width: 90vw;
          animation: feedbackPop 0.3s ease-out;
        `;

        // Responsive sizing
        if (screenWidth <= 320) {
          feedbackStyle += `
            padding: 12px 15px;
            font-size: 11px;
            border-radius: 6px;
          `;
        } else if (screenWidth <= 480) {
          feedbackStyle += `
            padding: 14px 18px;
            font-size: 12px;
          `;
        } else if (screenWidth <= 768) {
          feedbackStyle += `
            padding: 16px 20px;
            font-size: 13px;
          `;
        } else {
          feedbackStyle += `
            padding: 15px 25px;
            font-size: 14px;
          `;
        }

        feedback.style.cssText = feedbackStyle;
        feedback.textContent = message;

        // Add animation keyframes if not already added
        if (!document.querySelector("#feedbackAnimation")) {
          const style = document.createElement("style");
          style.id = "feedbackAnimation";
          style.textContent = `
            @keyframes feedbackPop {
              0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
              100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            }
          `;
          document.head.appendChild(style);
        }

        document.body.appendChild(feedback);

        setTimeout(() => {
          feedback.style.opacity = "0";
          feedback.style.transform = "translate(-50%, -50%) scale(0.9)";
          setTimeout(() => feedback.remove(), 300);
        }, 2500);
      }

      function downloadVariations() {
        const variationsToUse = currentSearchTerm
          ? allVariations
          : originalVariations;
        const allText = variationsToUse.join("\n");
        const blob = new Blob([allText], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `gmail-variations-${
          variationsToUse.length
        }-${Date.now()}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        // Update saved count
        timesSavedCount += variationsToUse.length;
        updateStats(0);

        // Show feedback
        showDownloadFeedback(
          `üíæ Downloaded ${variationsToUse.length.toLocaleString()} variations as TXT!`
        );
      }

      function generateEmails() {
        const emailInput = document.getElementById("emailInput");
        const resultsContainer = document.getElementById("resultsContainer");
        const email = emailInput.value.trim();

        if (!email) {
          alert("Please enter an email address");
          return;
        }

        if (!isValidGmail(email)) {
          alert(
            "Please enter a valid Gmail address (e.g., user@gmail.com or user.name@gmail.com)"
          );
          return;
        }

        // Calculate potential variations and provide intelligent warnings
        const username = email.split("@")[0].replace(/\./g, "");
        // REMOVED * 2 - We only generate for @gmail.com now
        const totalPossible = Math.pow(2, Math.max(0, username.length - 1));

        let warningMessage = "";
        let proceedMessage = "";

        if (totalPossible > 50000000) {
          // 50M+
          warningMessage = `This will generate ${totalPossible.toLocaleString()} total variations (${
            username.length
          } character username).`;
          proceedMessage =
            "‚ö° MEGA DATASET: We'll use advanced sampling to generate ~200K strategic variations that cover all patterns efficiently. Continue?";
        } else if (totalPossible > 5000000) {
          // 5M+
          warningMessage = `This will generate ${totalPossible.toLocaleString()} variations (${
            username.length
          } character username).`;
          proceedMessage =
            "üöÄ LARGE DATASET: We'll use intelligent sampling for optimal performance. Continue?";
        } else if (totalPossible > 500000) {
          // 500K+
          warningMessage = `This will generate ${totalPossible.toLocaleString()} variations (${
            username.length
          } character username).`;
          proceedMessage =
            "‚ö° BIG DATASET: Processing will use optimized batching. Continue?";
        } else if (totalPossible > 50000) {
          // 50K+
          warningMessage = `This will generate ${totalPossible.toLocaleString()} variations (${
            username.length
          } character username).`;
          proceedMessage =
            "Large dataset - may take a moment to process. Continue?";
        }

        if (warningMessage) {
          const proceed = confirm(warningMessage + "\n\n" + proceedMessage);
          if (!proceed) return;
        }

        try {
          // Start performance monitoring
          generationStartTime = performance.now();

          // Show loading state
          const loadingDiv = document.createElement("div");
          loadingDiv.id = "loadingIndicator";
          loadingDiv.style.cssText = `
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(69, 183, 209, 0.1));
            border: 1px solid rgba(78, 205, 196, 0.5);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            font-size: 14px;
            color: #4ecdc4;
            margin-bottom: 15px;
          `;

          // Determine loading message based on generation strategy
          let loadingMessage = "";
          if (totalPossible > 50000000) {
            loadingMessage = `
              <strong>üöÄ Processing...</strong><br>
              Using smart sampling to generate ~200K strategic variations
              <div style="margin-top: 8px; font-size: 12px; opacity: 0.8;">
                Advanced algorithms creating comprehensive coverage patterns
              </div>
            `;
          } else if (totalPossible > 5000000) {
            loadingMessage = `
              <strong>‚ö° Processing...</strong><br>
              Generating intelligent sample of variations
              <div style="margin-top: 8px; font-size: 12px; opacity: 0.8;">
                Optimizing performance for large dataset
              </div>
            `;
          } else if (totalPossible > 500000) {
            loadingMessage = `
              <strong>üîÑ Processing...</strong><br>
              Generating ${totalPossible.toLocaleString()} variations with batching
              <div style="margin-top: 8px; font-size: 12px; opacity: 0.8;">
                Using optimized processing for better performance
              </div>
            `;
          } else {
            loadingMessage = `
              <strong>üîÑ Processing...</strong><br>
              Generating ${totalPossible.toLocaleString()} email variations
              <div style="margin-top: 8px; font-size: 12px; opacity: 0.8;">
                Please wait while we process your request
              </div>
            `;
          }

          loadingDiv.innerHTML = loadingMessage;
          resultsContainer.innerHTML = "";
          resultsContainer.appendChild(loadingDiv);

          // Use setTimeout to allow UI to update before heavy computation
          setTimeout(() => {
            const variations = generateGmailVariations(email);

            // Calculate generation time
            lastGenerationTime = performance.now() - generationStartTime;

            displayResults(variations, email);

            // Remove loading indicator
            const loading = document.getElementById("loadingIndicator");
            if (loading) loading.remove();

            // Add performance info for large datasets
            if (variations.length > 1000) {
              const perfDiv = document.createElement("div");
              perfDiv.style.cssText = `
                background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.1));
                border: 1px solid rgba(138, 43, 226, 0.5);
                border-radius: 8px;
                padding: 8px 12px;
                margin-bottom: 10px;
                font-size: 11px;
                color: #dda0dd;
                text-align: center;
              `;

              const originalPossible = Math.pow(
                2,
                Math.max(0, username.length - 1)
              );
              let perfMessage = `‚ö° Generated ${variations.length.toLocaleString()} variations in ${lastGenerationTime.toFixed(
                2
              )}ms`;

              if (originalPossible > 1000000) {
                perfMessage += `<br>üß† Smart sampling: ${variations.length.toLocaleString()} strategic patterns from ${originalPossible.toLocaleString()} total possible`;
              }

              if (variations.length > 10000) {
                perfMessage +=
                  " | üöÄ Virtual scrolling enabled for optimal performance";
              }

              perfDiv.innerHTML = perfMessage;
              resultsContainer.insertBefore(
                perfDiv,
                resultsContainer.firstChild
              );
            }

            // Add search and bulk actions for large datasets
            if (variations.length > 50) {
              addSearchBox(resultsContainer);
              addBulkActions(resultsContainer);
            }

            // Add scroll buttons for scrollable content
            setTimeout(() => {
              addScrollButtons(resultsContainer);
            }, 200);
          }, 100);
        } catch (error) {
          console.error("Generation error:", error);
          alert(
            "An error occurred while generating variations. Please check your email format."
          );
        }
      }

      function isValidGmail(email) {
        const gmailRegex = /^[a-zA-Z0-9.]+@(gmail\.com|googlemail\.com)$/;
        return gmailRegex.test(email);
      }

      function generateGmailVariations(email) {
        const [username, domain] = email.split("@");
        const variations = new Set();

        // Clean username by removing existing dots
        const cleanUsername = username.replace(/\./g, "");
        const workingUsername = cleanUsername;

        // Add original email (cleaned), always as @gmail.com
        variations.add(`${workingUsername}@gmail.com`);

        // Generate ALL dot variations efficiently
        const dotVariations = generateAllDotVariations(workingUsername);

        dotVariations.forEach((variation) => {
          // Only add the @gmail.com variation
          variations.add(`${variation}@gmail.com`);
        });

        return Array.from(variations);
      }

      function generateAllDotVariations(username) {
        const variations = new Set();
        const len = username.length;

        if (len <= 1) {
          variations.add(username);
          return Array.from(variations);
        }

        // Add original username without dots
        variations.add(username);

        const totalCombinations = Math.pow(2, len - 1);

        // Smart memory management: For extremely large datasets (>1M combinations)
        // Use streaming generation to avoid memory crashes
        if (totalCombinations > 1000000) {
          return generateStreamedVariations(username, totalCombinations);
        }

        // For large but manageable datasets (10K-1M), use optimized batch processing
        if (totalCombinations > 10000) {
          return generateBatchedVariations(username, totalCombinations);
        }

        // For small datasets, generate all at once
        for (let i = 1; i < totalCombinations; i++) {
          let variation = "";
          for (let j = 0; j < len; j++) {
            variation += username[j];
            if (j < len - 1 && i & (1 << j)) {
              variation += ".";
            }
          }
          variations.add(variation);
        }

        return Array.from(variations);
      }

      // Optimized batch processing for large datasets
      function generateBatchedVariations(username, totalCombinations) {
        const variations = new Set();
        const len = username.length;

        // Add original username
        variations.add(username);

        const batchSize = 50000; // Larger batches for better performance

        for (
          let batch = 0;
          batch < Math.ceil(totalCombinations / batchSize);
          batch++
        ) {
          const start = batch * batchSize;
          const end = Math.min(start + batchSize, totalCombinations);

          for (let i = start; i < end; i++) {
            if (i === 0) continue; // Skip 0 as it's the original

            let variation = "";
            let binaryString = i.toString(2).padStart(len - 1, "0");

            for (let j = 0; j < len; j++) {
              variation += username[j];
              if (j < len - 1 && binaryString[j] === "1") {
                variation += ".";
              }
            }
            variations.add(variation);
          }
        }

        return Array.from(variations);
      }

      // Streaming generation for massive datasets (millions of variations)
      function generateStreamedVariations(username, totalCombinations) {
        // For extremely large datasets, we'll generate strategic samples
        // to provide a comprehensive set without memory crashes

        const strategicVariations = new Set();
        const len = username.length;

        // Add original
        strategicVariations.add(username);

        // Strategy 1: All single-dot positions
        for (let i = 0; i < len - 1; i++) {
          const variation =
            username.slice(0, i + 1) + "." + username.slice(i + 1);
          strategicVariations.add(variation);
        }

        // Strategy 2: Pattern-based distributions
        const patterns = [
          // Every 2nd position
          Array.from({ length: Math.floor((len - 1) / 2) }, (_, i) => i * 2),
          // Every 3rd position
          Array.from({ length: Math.floor((len - 1) / 3) }, (_, i) => i * 3),
          // Fibonacci-like spacing
          [0, 1, 2, 3, 5, 8, 13].filter((x) => x < len - 1),
          // Beginning, middle, end clusters
          [
            0,
            1,
            Math.floor(len / 2),
            Math.floor(len / 2) + 1,
            len - 3,
            len - 2,
          ].filter((x) => x >= 0 && x < len - 1),
          // Golden ratio positions
          Array.from(
            { length: 5 },
            (_, i) => Math.floor((len - 1) * (i + 1) * 0.618) % (len - 1)
          ),
        ];

        patterns.forEach((positions) => {
          if (positions.length > 0) {
            let variation = "";
            for (let j = 0; j < len; j++) {
              variation += username[j];
              if (j < len - 1 && positions.includes(j)) {
                variation += ".";
              }
            }
            strategicVariations.add(variation);
          }
        });

        // Strategy 3: Random sampling for diversity (with deterministic seed)
        const sampleSize = Math.min(
          100000,
          Math.floor(totalCombinations / 100)
        );
        const step = Math.floor(totalCombinations / sampleSize);

        for (let i = 1; i < totalCombinations; i += step) {
          let variation = "";
          let binaryString = i.toString(2).padStart(len - 1, "0");

          for (let j = 0; j < len; j++) {
            variation += username[j];
            if (j < len - 1 && binaryString[j] === "1") {
              variation += ".";
            }
          }
          strategicVariations.add(variation);

          if (strategicVariations.size >= sampleSize) break;
        }

        return Array.from(strategicVariations);
      }

      // Legacy function for backward compatibility - now just calls the main function
      function generateDotVariations(username) {
        return generateAllDotVariations(username);
      }

      function generateSafeVariations(username, maxCount) {
        const variations = new Set();
        const len = username.length;

        // Add the original username without dots
        variations.add(username);

        // Generate strategic variations instead of all combinations
        const strategies = [
          // Single dots at common positions
          ...Array.from(
            { length: len - 1 },
            (_, i) => username.slice(0, i + 1) + "." + username.slice(i + 1)
          ),
          // Double dots at strategic positions
          ...Array.from({ length: Math.min(5, len - 2) }, (_, i) => {
            const pos1 = Math.floor(len * 0.33) + i;
            const pos2 = Math.floor(len * 0.67) + i;
            if (pos1 < len - 1 && pos2 < len - 1 && pos1 !== pos2) {
              let result =
                username.slice(0, pos1 + 1) + "." + username.slice(pos1 + 1);
              const insertPos = pos2 + (pos1 < pos2 ? 1 : 0);
              return (
                result.slice(0, insertPos + 1) +
                "." +
                result.slice(insertPos + 1)
              );
            }
            return null;
          }).filter(Boolean),
          // Random strategic placements for variety
          ...Array.from({ length: Math.min(20, maxCount / 4) }, () => {
            const positions = [];
            const numDots = Math.floor(Math.random() * 3) + 1;

            for (let i = 0; i < numDots; i++) {
              const pos = Math.floor(Math.random() * (len - 1));
              if (!positions.includes(pos)) {
                positions.push(pos);
              }
            }

            positions.sort((a, b) => b - a); // Sort in reverse order
            let result = username;

            positions.forEach((pos) => {
              result = result.slice(0, pos + 1) + "." + result.slice(pos + 1);
            });

            return result;
          }),
        ];

        strategies.forEach((variation) => {
          if (variation && variations.size < maxCount) {
            variations.add(variation);
          }
        });

        return Array.from(variations);
      }

      // Global variables for virtual scrolling
      let allVariations = [];
      let originalVariations = []; // Store original unfiltered data
      let virtualScrollContainer = null;
      let visibleItems = [];
      const ITEM_HEIGHT = 45; // Height of each result item in pixels
      const VISIBLE_ITEMS = 10; // Number of items to render at once

      function displayResults(variations, email) {
        const resultsContainer = document.getElementById("resultsContainer");

        if (variations.length === 0) {
          resultsContainer.innerHTML =
            '<div class="result-item">No variations generated</div>';
          return;
        }

        // Store all variations globally
        allVariations = [...variations]; // Create a copy for filtering
        originalVariations = [...variations]; // Store original unfiltered data
        currentSearchTerm = ""; // Reset search

        // Calculate total possible variations
        const username = email.split("@")[0].replace(/\./g, "");
        const totalPossible = Math.pow(2, Math.max(0, username.length - 1)); // Removed * 2

        // Update dashboard stats
        updateStats(variations.length, totalPossible);

        // Clear container but preserve any existing info divs at the top
        const existingInfos = Array.from(resultsContainer.children).filter(
          (child) =>
            (child.style.background &&
              child.style.background.includes("rgba(138, 43, 226")) ||
            (child.style.background &&
              child.style.background.includes("rgba(0, 255, 100"))
        );
        resultsContainer.innerHTML = "";
        existingInfos.forEach((info) => resultsContainer.appendChild(info));

        // Show performance info for large datasets
        if (variations.length > 10000) {
          const infoDiv = document.createElement("div");
          infoDiv.style.cssText = `
            background: linear-gradient(135deg, rgba(0, 255, 100, 0.2), rgba(0, 200, 80, 0.1));
            border: 1px solid rgba(0, 255, 100, 0.5);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 12px;
            color: #00ff64;
          `;

          const originalPossible = Math.pow(
            2,
            originalVariations[0].split("@")[0].replace(/\./g, "").length - 1
          );

          if (originalPossible > 1000000) {
            infoDiv.innerHTML = `
              <strong>üß† Intelligent Sampling Mode Activated!</strong><br>
              Generated ${variations.length.toLocaleString()} strategic variations from ${originalPossible.toLocaleString()} total possible combinations.<br>
              <span style="opacity: 0.8;">Includes all single-dot patterns, mathematical sequences, and random sampling for comprehensive coverage.</span>
            `;
          } else {
            infoDiv.innerHTML = `
              <strong>üöÄ High Performance Mode Activated!</strong><br>
              Generated ${variations.length.toLocaleString()} variations using advanced virtual scrolling.<br>
              <span style="opacity: 0.8;">Scroll to view all results efficiently. Search and bulk operations available below.</span>
            `;
          }

          resultsContainer.appendChild(infoDiv);
        }

        // Create virtual scroll container for large datasets
        if (variations.length > 100) {
          createVirtualScrollContainer(resultsContainer);
        } else {
          // For smaller datasets, render normally
          variations.forEach((email) => {
            const resultItem = createResultItem(email);
            resultsContainer.appendChild(resultItem);
          });
        }
      }

      function createVirtualScrollContainer(container) {
        // Responsive height calculation
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;

        let containerHeight;
        if (screenWidth <= 320) {
          containerHeight = Math.min(
            VISIBLE_ITEMS * 35,
            Math.max(200, screenHeight * 0.3)
          );
        } else if (screenWidth <= 480) {
          containerHeight = Math.min(
            VISIBLE_ITEMS * 40,
            Math.max(250, screenHeight * 0.35)
          );
        } else if (screenWidth <= 768) {
          containerHeight = Math.min(
            VISIBLE_ITEMS * ITEM_HEIGHT,
            Math.max(300, screenHeight * 0.4)
          );
        } else {
          containerHeight = Math.min(VISIBLE_ITEMS * ITEM_HEIGHT, 400);
        }

        // Create virtual scroll wrapper
        const virtualWrapper = document.createElement("div");
        virtualWrapper.style.cssText = `
          height: ${containerHeight}px;
          overflow-y: auto;
          overflow-x: hidden;
          position: relative;
          border: none;
          border-radius: 8px;
          -webkit-overflow-scrolling: touch;
          scroll-behavior: smooth;
        `;

        // Create content container with full height
        const contentContainer = document.createElement("div");
        contentContainer.style.cssText = `
          height: ${allVariations.length * ITEM_HEIGHT}px;
          position: relative;
          width: 100%;
        `;

        // Create viewport for visible items
        const viewport = document.createElement("div");
        viewport.style.cssText = `
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          width: 100%;
        `;

        contentContainer.appendChild(viewport);
        virtualWrapper.appendChild(contentContainer);
        container.appendChild(virtualWrapper);

        // Store references
        virtualScrollContainer = {
          wrapper: virtualWrapper,
          content: contentContainer,
          viewport: viewport,
          scrollTop: 0,
          containerHeight: containerHeight,
        };

        // Initial render
        renderVisibleItems();

        // Handle scroll events with throttling
        let scrollTimeout;
        virtualWrapper.addEventListener("scroll", () => {
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(handleVirtualScroll, 16); // 60fps
        });

        // Handle resize events
        window.addEventListener("resize", () => {
          if (virtualScrollContainer) {
            const newScreenWidth = window.innerWidth;
            const newScreenHeight = window.innerHeight;

            let newHeight;
            if (newScreenWidth <= 320) {
              newHeight = Math.min(
                VISIBLE_ITEMS * 35,
                Math.max(200, newScreenHeight * 0.3)
              );
            } else if (newScreenWidth <= 480) {
              newHeight = Math.min(
                VISIBLE_ITEMS * 40,
                Math.max(250, newScreenHeight * 0.35)
              );
            } else if (newScreenWidth <= 768) {
              newHeight = Math.min(
                VISIBLE_ITEMS * ITEM_HEIGHT,
                Math.max(300, newScreenHeight * 0.4)
              );
            } else {
              newHeight = Math.min(VISIBLE_ITEMS * ITEM_HEIGHT, 400);
            }

            virtualScrollContainer.wrapper.style.height = newHeight + "px";
            virtualScrollContainer.containerHeight = newHeight;
            renderVisibleItems();
          }
        });
      }

      function handleVirtualScroll() {
        if (!virtualScrollContainer) return;

        const scrollTop = virtualScrollContainer.wrapper.scrollTop;
        virtualScrollContainer.scrollTop = scrollTop;

        // Throttle rendering for performance
        clearTimeout(virtualScrollContainer.scrollTimeout);
        virtualScrollContainer.scrollTimeout = setTimeout(
          renderVisibleItems,
          16
        ); // ~60fps
      }

      function renderVisibleItems() {
        if (!virtualScrollContainer) return;

        const scrollTop = virtualScrollContainer.scrollTop;
        const startIndex = Math.floor(scrollTop / ITEM_HEIGHT);
        const endIndex = Math.min(
          startIndex + VISIBLE_ITEMS + 2,
          allVariations.length
        ); // +2 for buffer

        // Clear viewport
        virtualScrollContainer.viewport.innerHTML = "";

        // Render visible items
        for (let i = startIndex; i < endIndex; i++) {
          const email = allVariations[i];
          if (email) {
            const resultItem = createResultItem(email);
            resultItem.style.cssText += `
              position: absolute;
              top: ${i * ITEM_HEIGHT}px;
              left: 0;
              right: 0;
              height: ${ITEM_HEIGHT - 8}px;
            `;
            virtualScrollContainer.viewport.appendChild(resultItem);
          }
        }
      }

      function createResultItem(email) {
        const container = document.createElement("div");
        container.style.cssText = `
          display: flex;
          align-items: center;
          gap: 10px;
          padding: 0;
          height: 100%;
          width: 100%;
        `;

        const resultItem = document.createElement("div");
        resultItem.className = "result-item";
        resultItem.textContent = email;
        resultItem.style.flex = "1";
        resultItem.style.cursor = "pointer";

        // Responsive styling based on screen size
        const screenWidth = window.innerWidth;

        if (screenWidth <= 320) {
          resultItem.style.cssText += `
            padding: 12px 15px;
            font-size: 11px;
            min-height: 44px;
            line-height: 1.4;
            word-break: break-word;
            overflow-wrap: anywhere;
            white-space: normal;
            overflow: hidden;
            flex-shrink: 0;
            max-width: 100%;
          `;
        } else if (screenWidth <= 480) {
          resultItem.style.cssText += `
            padding: 13px 16px;
            font-size: 12px;
            min-height: 44px;
            line-height: 1.4;
            word-break: break-word;
            overflow-wrap: anywhere;
            white-space: normal;
            overflow: hidden;
            flex-shrink: 0;
            max-width: 100%;
          `;
        } else if (screenWidth <= 768) {
          resultItem.style.cssText += `
            padding: 14px 17px;
            font-size: 13px;
            min-height: 44px;
            line-height: 1.4;
            word-break: break-word;
            overflow-wrap: anywhere;
            white-space: normal;
            overflow: hidden;
            flex-shrink: 0;
            max-width: 100%;
          `;
        } else {
          // Default styling for larger screens
          resultItem.style.cssText += `
            word-break: break-word;
            overflow-wrap: anywhere;
            white-space: normal;
            overflow: hidden;
            flex-shrink: 0;
            max-width: 100%;
            line-height: 1.4;
          `;
        }

        // Create Save button
        const saveBtn = document.createElement("button");
        saveBtn.textContent = "üíæ Save";
        saveBtn.style.cssText = `
          padding: 8px 12px;
          background: linear-gradient(135deg, #4ECDC4, #45B7D1);
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-weight: bold;
          font-size: 12px;
          white-space: nowrap;
          flex-shrink: 0;
          margin-right: 10px;
          transition: all 0.2s;
        `;

        saveBtn.onmouseover = () => {
          saveBtn.style.transform = "scale(1.05)";
          saveBtn.style.boxShadow = "0 0 10px rgba(78, 205, 196, 0.5)";
        };

        saveBtn.onmouseout = () => {
          saveBtn.style.transform = "";
          saveBtn.style.boxShadow = "";
        };

        let isSaved = false; // Track if this email is already saved

        saveBtn.onclick = async (e) => {
          e.stopPropagation();
          
          if (isSaved) {
            showNotification('Email already saved!', 'info');
            return;
          }

          try {
            // Save to Supabase
            if (typeof saveEmailVariation === 'function') {
              const saved = await saveEmailVariation(email);
              if (saved) {
                // Disable button and gray it out
                isSaved = true;
                saveBtn.disabled = true;
                saveBtn.textContent = "‚úÖ Saved";
                saveBtn.style.background = "#666666";
                saveBtn.style.cursor = "default";
                saveBtn.style.opacity = "0.6";
                incrementSavedCount();
                console.log('Email saved and button disabled');
              }
            }
          } catch (err) {
            console.error('Error:', err);
            showNotification('Error saving email', 'error');
          }
        };

        // Enhanced touch handling for mobile devices
        if ("ontouchstart" in window) {
          resultItem.style.cssText += `
            -webkit-tap-highlight-color: rgba(78, 205, 196, 0.3);
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
          `;

          // Touch feedback on result item (for copying)
          resultItem.addEventListener("touchstart", () => {
            resultItem.style.transform = "scale(0.98)";
            resultItem.style.background =
              "linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(69, 183, 209, 0.15))";
          });

          resultItem.addEventListener("touchend", () => {
            setTimeout(() => {
              resultItem.style.transform = "";
              resultItem.style.background = "";
            }, 150);
          });
        }

        // Click on email text to ONLY copy (not save)
        resultItem.onclick = () => {
          navigator.clipboard.writeText(email).then(() => {
            resultItem.classList.add("copied");
            showNotification('‚úÖ Copied to clipboard!', 'success', 1500);
            setTimeout(() => {
              resultItem.classList.remove("copied");
            }, 1500);
          }).catch(err => {
            console.error('Copy failed:', err);
            showNotification('Failed to copy', 'error');
          });
        };
        
        container.appendChild(saveBtn);
        container.appendChild(resultItem);
        return container;
      }

      function copyToClipboard(text, element) {
        navigator.clipboard
          .writeText(text)
          .then(async () => {
            element.classList.add("copied");
            incrementSavedCount();
            
            console.log('Email copied to clipboard, attempting to save...');
            // Save to Supabase database
            try {
              if (typeof saveEmailVariation === 'function') {
                const saved = await saveEmailVariation(text);
                console.log('Save result:', saved);
              } else {
                console.error('saveEmailVariation function not found');
              }
            } catch (err) {
              console.error('Error in clipboard save:', err);
            }
            
            setTimeout(() => {
              element.classList.remove("copied");
            }, 1000);
          })
          .catch(async (err) => {
            console.error('Clipboard API error:', err);
            
            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);

            element.classList.add("copied");
            incrementSavedCount();
            
            console.log('Email copied to clipboard (fallback), attempting to save...');
            // Save to Supabase database
            try {
              if (typeof saveEmailVariation === 'function') {
                const saved = await saveEmailVariation(text);
                console.log('Save result:', saved);
              } else {
                console.error('saveEmailVariation function not found');
              }
            } catch (err) {
              console.error('Error in clipboard save:', err);
            }
            
            setTimeout(() => {
              element.classList.remove("copied");
            }, 1000);
          });
      }
    </script>
  </body>
</html>